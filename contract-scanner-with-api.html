<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Scanner - Instant Legal Risk Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Newsreader:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0A0E27;
            --accent: #00D9FF;
            --danger: #FF3366;
            --warning: #FFB800;
            --success: #00FF88;
            --bg: #FAFBFC;
            --card: #FFFFFF;
            --border: #E1E8ED;
            --text-primary: #0A0E27;
            --text-secondary: #5F6C7B;
        }

        body {
            font-family: 'Newsreader', Georgia, serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .mono {
            font-family: 'IBM Plex Mono', monospace;
        }

        .hero-gradient {
            background: linear-gradient(135deg, #0A0E27 0%, #1a2847 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 80%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 217, 255, 0.15) 0%, transparent 70%);
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1) translateY(0); opacity: 0.3; }
            50% { transform: scale(1.1) translateY(-5%); opacity: 0.5; }
        }

        .drag-zone {
            border: 3px dashed var(--border);
            background: var(--card);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .drag-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent) 0%, var(--success) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .drag-zone.drag-over {
            border-color: var(--accent);
            background: rgba(0, 217, 255, 0.05);
            transform: scale(1.02);
        }

        .drag-zone.drag-over::before {
            opacity: 0.1;
        }

        .risk-badge {
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) backwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .risk-high { 
            background: linear-gradient(135deg, #FF3366 0%, #FF6B9D 100%);
            box-shadow: 0 4px 20px rgba(255, 51, 102, 0.3);
        }
        .risk-medium { 
            background: linear-gradient(135deg, #FFB800 0%, #FFC933 100%);
            box-shadow: 0 4px 20px rgba(255, 184, 0, 0.3);
        }
        .risk-low { 
            background: linear-gradient(135deg, #00D9FF 0%, #33E1FF 100%);
            box-shadow: 0 4px 20px rgba(0, 217, 255, 0.3);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-bar {
            height: 4px;
            background: var(--accent);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }

        .scan-pulse {
            animation: scanPulse 1.5s ease-in-out infinite;
        }

        @keyframes scanPulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .sample-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 2px solid var(--border);
        }

        .sample-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 217, 255, 0.2);
        }

        .stat-number {
            font-feature-settings: 'tnum';
            font-variant-numeric: tabular-nums;
        }

        .checkmark {
            animation: checkmark 0.5s ease-out;
        }

        @keyframes checkmark {
            0% { transform: scale(0) rotate(45deg); }
            50% { transform: scale(1.1) rotate(45deg); }
            100% { transform: scale(1) rotate(45deg); }
        }

        .script-box {
            background: linear-gradient(135deg, #F8F9FA 0%, #FFFFFF 100%);
            border-left: 4px solid var(--accent);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
            position: relative;
        }

        .risk-gauge {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .risk-gauge-bg {
            stroke: #E1E8ED;
            fill: none;
            stroke-width: 20;
        }

        .risk-gauge-fill {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-out;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .grade-A { stroke: #00FF88; }
        .grade-B { stroke: #00D9FF; }
        .grade-C { stroke: #FFB800; }
        .grade-D { stroke: #FF8800; }
        .grade-F { stroke: #FF3366; }

        .comparison-row {
            transition: all 0.2s;
        }

        .comparison-row:hover {
            background: #F8F9FA;
            transform: translateX(4px);
        }

        .status-above {
            color: #FF3366;
            background: rgba(255, 51, 102, 0.1);
        }

        .status-below {
            color: #FF8800;
            background: rgba(255, 136, 0, 0.1);
        }

        .status-fair {
            color: #00FF88;
            background: rgba(0, 255, 136, 0.1);
        }

        .category-bar {
            height: 8px;
            background: #E1E8ED;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .category-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }

        .breakdown-card {
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) backwards;
        }

        .tab-button {
            position: relative;
            padding: 12px 24px;
            background: transparent;
            border: none;
            font-weight: 600;
            color: #5F6C7B;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-button.active {
            color: var(--primary);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--success));
            border-radius: 3px 3px 0 0;
        }

        .copy-feedback {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--primary);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            z-index: 1000;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================================
        // INSERT YOUR GOOGLE GEMINI API KEY HERE (get from aistudio.google.com/apikey)
        // Paste between the quotes. Leave empty to use the server (.env) instead.
        // ============================================================
        const GEMINI_API_KEY = 'AIzaSyB_lVto4qf4Hp9OfuqTBGlzFXmK8KjEuxk';

        // Risk Score Gauge Component
        function RiskScoreGauge({ score, grade }) {
            const circumference = 2 * Math.PI * 80; // radius = 80
            const offset = circumference - (score / 100) * circumference;
            
            const getGradeClass = (grade) => {
                const letter = grade.charAt(0);
                return `grade-${letter}`;
            };

            const getGradeColor = (grade) => {
                const letter = grade.charAt(0);
                const colors = {
                    'A': '#00FF88',
                    'B': '#00D9FF',
                    'C': '#FFB800',
                    'D': '#FF8800',
                    'F': '#FF3366'
                };
                return colors[letter] || '#FFB800';
            };

            return (
                <div className="risk-gauge mx-auto">
                    <svg width="200" height="200" viewBox="0 0 200 200">
                        <circle
                            className="risk-gauge-bg"
                            cx="100"
                            cy="100"
                            r="80"
                        />
                        <circle
                            className={`risk-gauge-fill ${getGradeClass(grade)}`}
                            cx="100"
                            cy="100"
                            r="80"
                            strokeDasharray={circumference}
                            strokeDashoffset={offset}
                        />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <div className="text-5xl font-bold" style={{ color: getGradeColor(grade) }}>
                            {grade}
                        </div>
                        <div className="text-2xl font-bold text-gray-600 stat-number">{score}</div>
                        <div className="text-sm text-gray-500 mono">out of 100</div>
                    </div>
                </div>
            );
        }

        // Sample contract data for demo purposes
        const SAMPLE_CONTRACTS = {
            lease: {
                name: "Apartment Lease Agreement",
                type: "Residential Lease",
                icon: "ðŸ ",
                riskScore: {
                    overall: 58,
                    grade: "C-",
                    breakdown: [
                        { category: "Financial Terms", score: 72, grade: "B", status: "good rent, bad fees" },
                        { category: "Legal Compliance", score: 45, grade: "D", status: "2 unenforceable clauses" },
                        { category: "Tenant Rights", score: 65, grade: "C", status: "weak maintenance terms" },
                        { category: "Hidden Costs", score: 35, grade: "F", status: "$650/year in excessive fees" }
                    ]
                },
                comparison: {
                    location: "Austin, TX",
                    contractsAnalyzed: 247,
                    metrics: [
                        { 
                            label: "Monthly Rent", 
                            yourValue: "$1,850", 
                            marketAvg: "$1,720", 
                            difference: "+7.6%", 
                            status: "above",
                            suggestion: "Ask for $130/month reduction to match market rate"
                        },
                        { 
                            label: "Security Deposit", 
                            yourValue: "$1,850", 
                            marketAvg: "$1,720", 
                            difference: "Market standard", 
                            status: "fair",
                            suggestion: "This is standard (1 month rent)"
                        },
                        { 
                            label: "Late Fee", 
                            yourValue: "$75", 
                            marketAvg: "$28", 
                            difference: "+168%", 
                            status: "above",
                            suggestion: "Illegal under TX law - demand $25 maximum"
                        },
                        { 
                            label: "Pet Deposit", 
                            yourValue: "$300 + $25/mo", 
                            marketAvg: "$200 + $15/mo", 
                            difference: "+50%", 
                            status: "above",
                            suggestion: "Negotiate to $200 + $15/month"
                        },
                        { 
                            label: "Lease Length", 
                            yourValue: "12 months", 
                            marketAvg: "12 months", 
                            difference: "Market standard", 
                            status: "fair",
                            suggestion: null
                        }
                    ]
                },
                analysis: {
                    summary: [
                        "Rent: $1,850/month (due on 1st of month)",
                        "Security deposit: $1,850 (refundable within 30 days)",
                        "Lease term: 12 months (March 1, 2026 - Feb 28, 2027)",
                        "Property: 2BR/1BA, 850 sq ft",
                        "Utilities: Tenant pays electric, water, gas"
                    ],
                    risks: [
                        {
                            severity: "high",
                            title: "Late fee exceeds legal maximum",
                            description: "$75 late fee charged after 3-day grace period",
                            standard: "Texas law caps late fees at the greater of $25 or 5% of monthly rent ($92.50 max for this lease)",
                            savings: "$75 per incident",
                            legalCode: "Texas Property Code Â§92.019",
                            script: `Hi [Landlord Name],

I noticed the lease lists a $75 late fee in Section 4.2. According to Texas Property Code Â§92.019, late fees are capped at the greater of $25 or 5% of monthly rent.

For a $1,850/month lease, the legal maximum is $92.50, but I'd like to propose the standard $25 flat fee, which is common in the Austin market.

Could we update Section 4.2 to reflect this? Happy to sign an addendum.

Thanks,
[Your Name]`
                        },
                        {
                            severity: "high",
                            title: "Illegal entry notice provision",
                            description: "Landlord may enter with only 12 hours notice",
                            standard: "Texas requires minimum 24-hour notice for non-emergency entry",
                            savings: "Protection of privacy rights",
                            legalCode: "Texas Property Code Â§92.0081",
                            script: `Hi [Landlord Name],

I see Section 8.1 allows entry with 12-hour notice. Texas Property Code Â§92.0081 requires at least 24 hours notice for non-emergency situations.

Could we update this section to comply with state law? This protects both our interests.

Best,
[Your Name]`
                        },
                        {
                            severity: "medium",
                            title: "High mandatory insurance requirement",
                            description: "Requires renters insurance with $15/month minimum premium",
                            standard: "Market average is $12/month for comparable coverage",
                            savings: "$36 per year",
                            script: `Hi [Landlord Name],

The lease requires renters insurance (which I support!), but specifies a $15/month minimum premium. I've found quality policies from Lemonade and State Farm for $12/month that meet the coverage requirements in Section 9.3.

Can we adjust this to allow any policy meeting the coverage minimums, regardless of cost?

Thanks,
[Your Name]`
                        },
                        {
                            severity: "medium",
                            title: "No maintenance response timeline",
                            description: "Lease doesn't specify timeframe for repair requests",
                            standard: "Industry standard: 24 hours for emergencies, 5 business days for non-emergency",
                            savings: "Faster resolution of issues",
                            script: `Hi [Landlord Name],

I'd like to add maintenance response timelines to Section 7.1 for clarity:
- Emergency repairs (no heat, water, etc.): 24 hours
- Non-emergency repairs: 5 business days

This protects both of us with clear expectations. Can we add this as an addendum?

Thanks,
[Your Name]`
                        }
                    ],
                    totalSavings: "$111+ annually, plus legal protections"
                }
            },
            freelance: {
                name: "Freelance Service Agreement",
                type: "Independent Contractor",
                icon: "ðŸ“",
                riskScore: {
                    overall: 52,
                    grade: "D+",
                    breakdown: [
                        { category: "Payment Terms", score: 68, grade: "C", status: "net-30 is acceptable" },
                        { category: "Scope Protection", score: 25, grade: "F", status: "unlimited revisions clause" },
                        { category: "IP Rights", score: 40, grade: "F", status: "overly broad assignment" },
                        { category: "Legal Protection", score: 75, grade: "B", status: "good termination terms" }
                    ]
                },
                comparison: {
                    location: "National (Remote Work)",
                    contractsAnalyzed: 189,
                    metrics: [
                        { 
                            label: "Hourly Rate", 
                            yourValue: "$85/hr", 
                            marketAvg: "$92/hr", 
                            difference: "-7.6%", 
                            status: "below",
                            suggestion: "Industry average for senior designers is $92/hr"
                        },
                        { 
                            label: "Payment Terms", 
                            yourValue: "Net-30", 
                            marketAvg: "Net-30", 
                            difference: "Market standard", 
                            status: "fair",
                            suggestion: null
                        },
                        { 
                            label: "Revision Rounds", 
                            yourValue: "Unlimited", 
                            marketAvg: "2 rounds", 
                            difference: "Unlimited vs 2", 
                            status: "below",
                            suggestion: "Limit to 2 rounds, then bill hourly for additional changes"
                        },
                        { 
                            label: "Late Payment Penalty", 
                            yourValue: "None", 
                            marketAvg: "1.5% monthly", 
                            difference: "Missing", 
                            status: "below",
                            suggestion: "Add 1.5% monthly interest after 45 days"
                        },
                        { 
                            label: "IP Ownership", 
                            yourValue: "Client owns all", 
                            marketAvg: "Client owns deliverables", 
                            difference: "Too broad", 
                            status: "below",
                            suggestion: "Retain rights to unused concepts and preliminary work"
                        }
                    ]
                },
                analysis: {
                    summary: [
                        "Rate: $85/hour for design services",
                        "Payment terms: Net-30 via ACH or check",
                        "Termination: Either party with 14-day written notice",
                        "Work product: Digital design deliverables",
                        "Confidentiality: Standard NDA provisions"
                    ],
                    risks: [
                        {
                            severity: "high",
                            title: "Unlimited revision clause",
                            description: "Client can request unlimited revisions with no additional compensation",
                            standard: "Industry standard: 2 rounds of revisions included, hourly rate applies after",
                            savings: "~$2,000 per project in unpaid scope creep",
                            script: `Hi [Client Name],

I want to clarify the revision process in Section 3.4. The current "unlimited revisions" language can lead to scope creep.

I propose: "Up to 2 rounds of revisions included in project fee. Additional revisions billed at $85/hour."

This is industry standard and ensures clear expectations. Can we update the contract?

Best,
[Your Name]`
                        },
                        {
                            severity: "high",
                            title: "Overly broad IP assignment",
                            description: "Client owns all work product, including unused concepts and preliminary sketches",
                            standard: "Industry standard: Client owns final deliverables only; designer retains preliminary work",
                            savings: "Portfolio rights and ability to reuse concepts",
                            script: `Hi [Client Name],

Section 5.2 assigns all work product to you, including unused concepts. Standard practice is:

- You own final approved deliverables
- I retain preliminary sketches and unused concepts for my portfolio
- I can show work in portfolio with credit to your company

This protects my ability to showcase my work while giving you full rights to deliverables. Can we adjust Section 5.2?

Thanks,
[Your Name]`
                        },
                        {
                            severity: "medium",
                            title: "No late payment penalty",
                            description: "Contract has no consequences for payments beyond Net-30",
                            standard: "Industry standard: 1.5% monthly interest after 45 days",
                            savings: "Incentive for timely payment",
                            script: `Hi [Client Name],

I'd like to add a late payment clause to Section 4.3:

"Invoices unpaid after 45 days will accrue 1.5% monthly interest until paid in full."

This is standard business practice and encourages timely payment for both of us.

Best,
[Your Name]`
                        }
                    ],
                    totalSavings: "$2,000+ per project, plus portfolio rights"
                }
            },
            jobOffer: {
                name: "Software Engineer Offer Letter",
                type: "Employment Agreement",
                icon: "ðŸ’¼",
                riskScore: {
                    overall: 74,
                    grade: "B",
                    breakdown: [
                        { category: "Compensation", score: 82, grade: "A-", status: "competitive salary + equity" },
                        { category: "Benefits", score: 78, grade: "B+", status: "standard benefits package" },
                        { category: "Non-Compete", score: 35, grade: "F", status: "overly broad restrictions" },
                        { category: "Equity Terms", score: 70, grade: "B-", status: "standard 4yr vest with 1yr cliff" }
                    ]
                },
                comparison: {
                    location: "Denver, CO - Tech Industry",
                    contractsAnalyzed: 156,
                    metrics: [
                        { 
                            label: "Base Salary", 
                            yourValue: "$95,000", 
                            marketAvg: "$98,500", 
                            difference: "-3.6%", 
                            status: "fair",
                            suggestion: "Within competitive range for SWE II in Denver"
                        },
                        { 
                            label: "Equity Grant", 
                            yourValue: "5,000 options", 
                            marketAvg: "6,200 options", 
                            difference: "-19%", 
                            status: "below",
                            suggestion: "Ask for 6,000-6,500 options to match market"
                        },
                        { 
                            label: "PTO Days", 
                            yourValue: "15 days", 
                            marketAvg: "18 days", 
                            difference: "-16.7%", 
                            status: "below",
                            suggestion: "Negotiate for 18-20 days (industry standard)"
                        },
                        { 
                            label: "401k Match", 
                            yourValue: "4%", 
                            marketAvg: "4.5%", 
                            difference: "-11%", 
                            status: "fair",
                            suggestion: "Close to market average"
                        },
                        { 
                            label: "Vesting Schedule", 
                            yourValue: "4yr/1yr cliff", 
                            marketAvg: "4yr/1yr cliff", 
                            difference: "Market standard", 
                            status: "fair",
                            suggestion: "Some startups offer 6-month cliff - worth asking"
                        },
                        { 
                            label: "Non-Compete Scope", 
                            yourValue: "12mo/50mi/all tech", 
                            marketAvg: "6mo/direct competitors", 
                            difference: "Too broad", 
                            status: "above",
                            suggestion: "Likely unenforceable in CO - negotiate narrower scope"
                        }
                    ]
                },
                analysis: {
                    summary: [
                        "Position: Software Engineer II",
                        "Salary: $95,000/year",
                        "Benefits: Health, dental, vision, 401k match (4%), 15 PTO days",
                        "Start date: March 15, 2026",
                        "Equity: 5,000 stock options, 4-year vest with 1-year cliff"
                    ],
                    risks: [
                        {
                            severity: "high",
                            title: "Overly broad non-compete",
                            description: "12-month non-compete covering 50-mile radius and entire tech industry",
                            standard: "Colorado courts rarely enforce broad non-competes; scope should be limited to direct competitors",
                            savings: "Career mobility rights",
                            legalCode: "Colorado precedent limits enforceability of broad non-competes",
                            script: `Hi [Hiring Manager],

I'm excited about this opportunity! I have one concern about the non-compete in Section 7.

The current language (12 months, 50-mile radius, all tech companies) is quite broad. Colorado courts typically limit these to direct competitors only.

Could we narrow it to: "6 months, direct competitors in the same product vertical"?

This protects your legitimate interests while preserving my career mobility.

Looking forward to discussing,
[Your Name]`
                        },
                        {
                            severity: "medium",
                            title: "Standard vesting cliff might be negotiable",
                            description: "Equity vests 25% after 1 year, then monthly (industry standard)",
                            standard: "Some companies offer 25% at 6 months for competitive offers",
                            savings: "Earlier access to equity value",
                            script: `Hi [Hiring Manager],

Thank you for the offer! I'm very interested in joining the team.

Regarding the equity in Section 5.2: Would you consider a 6-month cliff instead of 12 months for the first 25%? I've seen this at companies like [similar company] and it would help me commit fully knowing I'm building equity sooner.

Everything else looks great. Happy to discuss!

Best,
[Your Name]`
                        }
                    ],
                    totalSavings: "Career flexibility + earlier equity vesting"
                }
            }
        };

        function ContractScanner() {
            const [view, setView] = useState('landing'); // landing, loading, results
            const [dragOver, setDragOver] = useState(false);
            const [selectedContract, setSelectedContract] = useState(null);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [loadingMessage, setLoadingMessage] = useState('');
            const [showCopyFeedback, setShowCopyFeedback] = useState(false);
            const [expandedRisk, setExpandedRisk] = useState(null);
            const [activeTab, setActiveTab] = useState('overview'); // overview, comparison, risks
            const fileInputRef = useRef(null);

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = () => {
                setDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);
                const file = e.dataTransfer.files[0];
                if (file) processFile(file);
            };

            const handleFileSelect = (e) => {
                const file = e.target.files[0];
                if (file) processFile(file);
            };

            // Extract text from file (PDF or DOCX)
            const extractTextFromFile = async (file) => {
                const fileType = file.type;
                const fileName = (file.name || '').toLowerCase();
                const isPdf = fileType === 'application/pdf' || fileName.endsWith('.pdf');
                const isDocx = fileType.includes('wordprocessingml') || fileName.endsWith('.docx') || fileName.endsWith('.doc');
                
                if (isPdf) {
                    return await extractPDF(file);
                } else if (isDocx) {
                    return await extractDOCX(file);
                } else {
                    throw new Error('Unsupported file type. Use PDF or DOCX.');
                }
            };

            const extractPDF = async (file) => {
                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
                const pdf = await loadingTask.promise;
                
                let fullText = '';
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n\n';
                }
                return fullText;
            };

            const extractDOCX = async (file) => {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                return result.value;
            };

            const detectContractType = (text) => {
                const lowerText = text.toLowerCase();
                if (lowerText.includes('landlord') || lowerText.includes('tenant') || lowerText.includes('lease')) {
                    return 'lease';
                } else if (lowerText.includes('employment') || lowerText.includes('employee') || lowerText.includes('job offer')) {
                    return 'jobOffer';
                } else if (lowerText.includes('freelance') || lowerText.includes('independent contractor') || lowerText.includes('service agreement')) {
                    return 'freelance';
                }
                return 'lease';
            };

            const analyzeContractWithAPI = async (contractText, contractType) => {
                const typeGuidance = {
                    lease: { categories: ['Financial Terms', 'Legal Compliance', 'Tenant Rights', 'Hidden Costs'], issues: 'late fees, security deposits, maintenance response times, entry notice, pet fees' },
                    freelance: { categories: ['Payment Terms', 'Scope Protection', 'IP Rights', 'Legal Protection'], issues: 'revision limits, payment terms, IP ownership, late fees, kill fees' },
                    jobOffer: { categories: ['Compensation', 'Benefits', 'Non-Compete', 'Equity Terms'], issues: 'non-compete scope, equity vesting, PTO, salary benchmarks' }
                };
                const guidance = typeGuidance[contractType] || typeGuidance.lease;
                const comparisonHint = contractType === 'lease'
                    ? 'comparison.metrics: 5-6 items - Monthly Rent, Security Deposit, Late Fee, Pet Deposit, Lease Length, Entry Notice. For each: label, yourValue (from contract), marketAvg (typical), difference, status (above/below/fair), suggestion.'
                    : contractType === 'freelance'
                        ? 'comparison.metrics: 5-6 items - Rate, Payment Terms, Revision Rounds, Late Payment Penalty, IP Ownership. yourValue from contract, marketAvg typical.'
                        : 'comparison.metrics: 5-6 items - Base Salary, Equity, PTO, 401k Match, Vesting, Non-Compete. yourValue from contract, marketAvg typical.';
                const userPrompt = `Analyze this ${contractType} contract. Return valid JSON with: riskScore { overall, grade, breakdown }, comparison { location, contractsAnalyzed, metrics }, summary array, risks array, totalSavings. Categories: ${guidance.categories.join(', ')}. ${comparisonHint} yourValue MUST be the EXACT value from the contract text (e.g. "$1,850", "30 days"). NEVER use "not specified" or "obfuscated"â€”extract real values. If a term is absent, use "Not in contract". Return ONLY valid JSON.\n\nCONTRACT:\n${contractText.slice(0, 10000)}`;

                if (GEMINI_API_KEY && GEMINI_API_KEY.trim()) {
                    try {
                        const response = await fetch(
                            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`,
                            {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    system_instruction: { parts: [{ text: 'You are an expert legal contract analyzer. Extract EXACT values from the contractâ€”if rent is $1,850, write "$1,850". NEVER use "not specified", "obfuscated", or placeholders. If a term is not in the contract, use "Not in contract". Return only valid JSON, no markdown.' }] },
                                    contents: [{ parts: [{ text: userPrompt }] }],
                                    generationConfig: {
                                        temperature: 0.3,
                                        responseMimeType: 'application/json'
                                    }
                                })
                            }
                        );
                        const data = await response.json().catch(() => ({}));
                        if (!response.ok) {
                            const msg = data.error?.message || data.error?.message?.replace(/^.*?:\s*/, '') || `HTTP ${response.status}`;
                            throw new Error(msg);
                        }
                        let content = data.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (!content) throw new Error(data.error?.message || 'Empty response from API');
                        content = content.trim().replace(/^```(?:json)?\s*/, '').replace(/\s*```$/, '');
                        return JSON.parse(content);
                    } catch (err) {
                        const reason = err.message || (err.name === 'TypeError' && 'Network blocked (see below)') || 'Unknown error';
                        console.error('Gemini call failed:', err);
                        return { _error: reason };
                    }
                }

                try {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contractText, contractType })
                    });
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error || 'API error');
                    return data;
                } catch (err) {
                    console.error('Backend API failed:', err);
                    return null;
                }
            };

            const processFile = async (file) => {
                setView('loading');
                setLoadingProgress(0);
                
                const messages = [
                    'Extracting text from document...',
                    'Analyzing contract clauses...',
                    'Checking against legal standards...',
                    'Identifying unfair terms...',
                    'Calculating potential savings...',
                    'Generating negotiation scripts...',
                    'Finalizing analysis...'
                ];

                try {
                    // Step 1: Extract text
                    setLoadingMessage(messages[0]);
                    setLoadingProgress(15);
                    const contractText = await extractTextFromFile(file);
                    
                    if (!contractText || contractText.length < 100) {
                        throw new Error('Could not extract text from file');
                    }

                    // Step 2: Detect type
                    setLoadingMessage(messages[1]);
                    setLoadingProgress(30);
                    const contractType = detectContractType(contractText);

                    // Step 3: Analyze via API (Gemini key in code or server .env)
                    setLoadingMessage(messages[2]);
                    setLoadingProgress(50);
                    
                    let analysis = await analyzeContractWithAPI(contractText, contractType);
                    const apiError = analysis && analysis._error;
                    if (apiError) analysis = null;

                    // Fall back to demo data if API unreachable or key invalid
                    if (!analysis) {
                        const isFileProtocol = !window.location.origin || window.location.origin === 'null' || window.location.protocol === 'file:';
                        let msg = 'API failed. Showing sample data.';
                        if (apiError) msg += '\n\nReason: ' + apiError;
                        if (isFileProtocol) {
                            msg += '\n\nFix: Browsers block API calls when you open the file directly. Run in Terminal from the folder that has this file:\n  npm start\nThen open http://localhost:3000 in your browser.';
                        } else if (apiError && (apiError.includes('Invalid') || apiError.includes('401') || apiError.includes('403') || apiError.includes('API key'))) {
                            msg += '\n\nCheck that your Gemini API key at the top of the file is correct (get one at aistudio.google.com/apikey).';
                        }
                        console.warn(msg);
                        for (let i = 3; i < messages.length; i++) {
                            setLoadingMessage(messages[i]);
                            setLoadingProgress(50 + (i / messages.length) * 50);
                            await new Promise(resolve => setTimeout(resolve, 400));
                        }
                        setSelectedContract(SAMPLE_CONTRACTS[contractType]);
                        setView('results');
                        alert(msg);
                        return;
                    }

                    // Step 4: Normalize API response (Gemini may return different shapes)
                    const toArray = (x) => Array.isArray(x) ? x : (x && typeof x === 'object' ? Object.values(x) : []);
                    const breakdown = toArray(analysis.riskScore?.breakdown);
                    const breakdownNormalized = breakdown.map((item) => {
                        if (typeof item === 'object' && item !== null) {
                            return {
                                category: item.category ?? item.name ?? 'Category',
                                score: typeof item.score === 'number' ? item.score : 50,
                                grade: item.grade ?? 'C',
                                status: item.status ?? ''
                            };
                        }
                        return { category: 'Category', score: 50, grade: 'C', status: String(item) };
                    });
                    const formattedContract = {
                        name: file.name.replace(/\.(pdf|docx|doc)$/i, ''),
                        type: contractType === 'lease' ? 'Residential Lease' : 
                              contractType === 'freelance' ? 'Independent Contractor' : 
                              'Employment Agreement',
                        icon: contractType === 'lease' ? 'ðŸ ' : 
                              contractType === 'freelance' ? 'ðŸ“' : 'ðŸ’¼',
                        riskScore: {
                            overall: typeof analysis.riskScore?.overall === 'number' ? analysis.riskScore.overall : 50,
                            grade: analysis.riskScore?.grade ?? 'C',
                            breakdown: breakdownNormalized.length ? breakdownNormalized : [
                                { category: 'Overall', score: analysis.riskScore?.overall ?? 50, grade: analysis.riskScore?.grade ?? 'C', status: '' }
                            ]
                        },
                        comparison: {
                            location: analysis.comparison?.location ?? 'N/A',
                            contractsAnalyzed: analysis.comparison?.contractsAnalyzed ?? 0,
                            metrics: toArray(analysis.comparison?.metrics).map((m) => typeof m === 'object' && m !== null ? {
                                label: m.label ?? m.name ?? '',
                                yourValue: m.yourValue ?? m.your ?? 'â€”',
                                marketAvg: m.marketAvg ?? m.market ?? 'â€”',
                                difference: m.difference ?? 'â€”',
                                status: m.status ?? 'fair',
                                suggestion: m.suggestion ?? null
                            } : { label: '', yourValue: 'â€”', marketAvg: 'â€”', difference: 'â€”', status: 'fair', suggestion: null })
                        },
                        analysis: {
                            summary: toArray(analysis.summary),
                            risks: toArray(analysis.risks).map((r) => typeof r === 'object' && r !== null ? {
                                severity: r.severity ?? 'medium',
                                title: r.title ?? '',
                                description: r.description ?? '',
                                standard: r.standard ?? '',
                                savings: r.savings ?? '',
                                legalCode: r.legalCode ?? null,
                                script: r.script ?? ''
                            } : { severity: 'medium', title: String(r), description: '', standard: '', savings: '', legalCode: null, script: '' }),
                            totalSavings: analysis.totalSavings ?? 'N/A'
                        }
                    };

                    setLoadingProgress(100);
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    setSelectedContract(formattedContract);
                    setView('results');

                } catch (error) {
                    console.error('Processing failed:', error);
                    alert(`Failed to analyze contract: ${error.message}\n\nPlease try again or use a sample contract.`);
                    setView('landing');
                }
            };

            const loadSampleContract = (type) => {
                setView('loading');
                setLoadingProgress(0);
                
                const simulateAnalysis = async () => {
                    const messages = [
                        'Loading sample contract...',
                        'Analyzing clauses...',
                        'Detecting risks...',
                        'Preparing results...'
                    ];

                    for (let i = 0; i < messages.length; i++) {
                        setLoadingMessage(messages[i]);
                        setLoadingProgress(((i + 1) / messages.length) * 100);
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }

                    setSelectedContract(SAMPLE_CONTRACTS[type]);
                    setView('results');
                };

                simulateAnalysis();
            };

            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text);
                setShowCopyFeedback(true);
                setTimeout(() => setShowCopyFeedback(false), 2000);
            };

            const reset = () => {
                setView('landing');
                setSelectedContract(null);
                setExpandedRisk(null);
                setActiveTab('overview');
            };

            return (
                <div className="min-h-screen">
                    {view === 'landing' && (
                        <div className="fade-in">
                            {/* Hero Section */}
                            <div className="hero-gradient text-white py-20 px-6">
                                <div className="max-w-6xl mx-auto relative z-10">
                                    <div className="text-center mb-12">
                                        <h1 className="text-5xl md:text-7xl font-bold mb-6 tracking-tight">
                                            Before you sign anything,<br />
                                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-[#00D9FF] to-[#00FF88]">
                                                scan it.
                                            </span>
                                        </h1>
                                        <p className="text-xl md:text-2xl text-gray-300 max-w-3xl mx-auto font-light">
                                            Upload any contract â†’ Get plain-English risks + negotiation scripts in 30 seconds
                                        </p>
                                    </div>

                                    {/* Main Upload Zone */}
                                    <div
                                        className={`drag-zone rounded-2xl p-16 text-center cursor-pointer mb-8 ${dragOver ? 'drag-over' : ''}`}
                                        onDragOver={handleDragOver}
                                        onDragLeave={handleDragLeave}
                                        onDrop={handleDrop}
                                        onClick={() => fileInputRef.current.click()}
                                    >
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".pdf,.doc,.docx"
                                            onChange={handleFileSelect}
                                            className="hidden"
                                        />
                                        <div className="text-6xl mb-6">ðŸ“„</div>
                                        <h3 className="text-2xl font-bold mb-3 text-gray-900">Drop your contract here</h3>
                                        <p className="text-gray-600 mb-6">or click to browse â€¢ PDF, DOC, DOCX up to 10MB</p>
                                        <button className="mono bg-gradient-to-r from-[#00D9FF] to-[#00FF88] text-white px-8 py-4 rounded-lg font-semibold text-lg hover:shadow-xl">
                                            Choose File
                                        </button>
                                    </div>

                                    {/* Sample Contracts */}
                                    <div className="text-center mb-8">
                                        <p className="text-gray-300 mb-6 mono text-sm tracking-wider uppercase">Or try a sample:</p>
                                        <div className="grid md:grid-cols-3 gap-4 max-w-4xl mx-auto">
                                            <div
                                                className="sample-card bg-white rounded-xl p-6"
                                                onClick={() => loadSampleContract('lease')}
                                            >
                                                <div className="text-4xl mb-3">ðŸ </div>
                                                <h4 className="font-bold text-lg mb-2">Apartment Lease</h4>
                                                <p className="text-sm text-gray-600">Residential rental agreement</p>
                                            </div>
                                            <div
                                                className="sample-card bg-white rounded-xl p-6"
                                                onClick={() => loadSampleContract('freelance')}
                                            >
                                                <div className="text-4xl mb-3">ðŸ“</div>
                                                <h4 className="font-bold text-lg mb-2">Freelance Contract</h4>
                                                <p className="text-sm text-gray-600">Service agreement for contractors</p>
                                            </div>
                                            <div
                                                className="sample-card bg-white rounded-xl p-6"
                                                onClick={() => loadSampleContract('jobOffer')}
                                            >
                                                <div className="text-4xl mb-3">ðŸ’¼</div>
                                                <h4 className="font-bold text-lg mb-2">Job Offer Letter</h4>
                                                <p className="text-sm text-gray-600">Employment offer with equity</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Stats Section */}
                            <div className="bg-white py-16 px-6">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-3xl md:text-4xl font-bold text-center mb-12">
                                        Most contracts are designed to be confusing
                                    </h2>
                                    <div className="grid md:grid-cols-3 gap-8 text-center">
                                        <div>
                                            <div className="stat-number text-5xl font-bold text-[#FF3366] mb-3">73%</div>
                                            <p className="text-gray-600">of people don't read contracts before signing</p>
                                        </div>
                                        <div>
                                            <div className="stat-number text-5xl font-bold text-[#00D9FF] mb-3">15-20</div>
                                            <p className="text-gray-600">contracts signed per person yearly</p>
                                        </div>
                                        <div>
                                            <div className="stat-number text-5xl font-bold text-[#FFB800] mb-3">$28B</div>
                                            <p className="text-gray-600">lost annually to hidden contract clauses</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Use Cases */}
                            <div className="bg-[#FAFBFC] py-16 px-6">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-3xl md:text-4xl font-bold text-center mb-4">
                                        Works for any contract
                                    </h2>
                                    <p className="text-xl text-gray-600 text-center mb-12 max-w-2xl mx-auto">
                                        From apartment leases to employment offers, we translate legalese into action
                                    </p>
                                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {[
                                            { icon: 'ðŸ ', title: 'Leases & Rentals', desc: 'Apartment leases, sublease agreements' },
                                            { icon: 'ðŸ“‹', title: 'Freelance Contracts', desc: 'Client agreements, service contracts' },
                                            { icon: 'ðŸ’¼', title: 'Job Offers', desc: 'Employment letters, non-competes' },
                                            { icon: 'ðŸ¤', title: 'NDAs', desc: 'Non-disclosure agreements' },
                                            { icon: 'ðŸ“„', title: 'Vendor Contracts', desc: 'Business service agreements' },
                                            { icon: 'ðŸŽ“', title: 'Student Agreements', desc: 'Internships, housing, loans' }
                                        ].map((item, i) => (
                                            <div key={i} className="bg-white rounded-xl p-6 border-2 border-[#E1E8ED]">
                                                <div className="text-3xl mb-3">{item.icon}</div>
                                                <h3 className="font-bold text-lg mb-2">{item.title}</h3>
                                                <p className="text-gray-600 text-sm">{item.desc}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'loading' && (
                        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0A0E27] to-[#1a2847] text-white fade-in">
                            <div className="text-center max-w-lg px-6">
                                <div className="text-6xl mb-8 scan-pulse">ðŸ”</div>
                                <h2 className="text-3xl font-bold mb-4">Scanning your contract...</h2>
                                <p className="text-xl text-gray-300 mb-8 mono">{loadingMessage}</p>
                                <div className="bg-white/20 rounded-full h-3 overflow-hidden mb-4">
                                    <div
                                        className="h-full bg-gradient-to-r from-[#00D9FF] to-[#00FF88] transition-all duration-300"
                                        style={{ width: `${loadingProgress}%` }}
                                    ></div>
                                </div>
                                <p className="mono text-sm text-gray-400">{Math.round(loadingProgress)}% complete</p>
                            </div>
                        </div>
                    )}

                    {view === 'results' && selectedContract && (
                        <div className="min-h-screen bg-[#FAFBFC] fade-in">
                            {/* Header */}
                            <div className="bg-white border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm">
                                <div className="max-w-6xl mx-auto flex items-center justify-between">
                                    <div className="flex items-center gap-4">
                                        <button
                                            onClick={reset}
                                            className="text-gray-600 hover:text-gray-900 mono text-sm font-semibold"
                                        >
                                            â† Scan Another
                                        </button>
                                        <div className="h-6 w-px bg-gray-300"></div>
                                        <div>
                                            <h2 className="font-bold text-lg flex items-center gap-2">
                                                <span>{selectedContract.icon}</span>
                                                {selectedContract.name}
                                            </h2>
                                            <p className="text-sm text-gray-600 mono">{selectedContract.type}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-6">
                                        <div className="text-center">
                                            <div className="text-sm text-gray-600 mono">Overall Score</div>
                                            <div className="text-2xl font-bold" style={{ 
                                                color: selectedContract.riskScore.grade.startsWith('A') ? '#00FF88' :
                                                       selectedContract.riskScore.grade.startsWith('B') ? '#00D9FF' :
                                                       selectedContract.riskScore.grade.startsWith('C') ? '#FFB800' :
                                                       selectedContract.riskScore.grade.startsWith('D') ? '#FF8800' : '#FF3366'
                                            }}>
                                                {selectedContract.riskScore.grade}
                                            </div>
                                        </div>
                                        <div className="mono text-sm">
                                            <span className="text-gray-600">Potential Savings:</span>
                                            <span className="ml-2 font-bold text-[#00FF88]">{selectedContract.analysis.totalSavings}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Tabs */}
                            <div className="bg-white border-b border-gray-200">
                                <div className="max-w-6xl mx-auto px-6">
                                    <div className="flex gap-2">
                                        <button
                                            className={`tab-button ${activeTab === 'overview' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('overview')}
                                        >
                                            ðŸ“Š Overview
                                        </button>
                                        <button
                                            className={`tab-button ${activeTab === 'comparison' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('comparison')}
                                        >
                                            ðŸ“ˆ Market Comparison
                                        </button>
                                        <button
                                            className={`tab-button ${activeTab === 'risks' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('risks')}
                                        >
                                            âš ï¸ Risks ({(selectedContract.analysis?.risks ?? []).length})
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="max-w-6xl mx-auto px-6 py-12">
                                {/* OVERVIEW TAB */}
                                {activeTab === 'overview' && (
                                    <div className="fade-in">
                                        {/* Risk Score Dashboard */}
                                        <div className="bg-white rounded-2xl p-8 mb-8 border-2 border-gray-200">
                                            <h3 className="text-2xl font-bold mb-8 text-center">Contract Fairness Score</h3>
                                            
                                            <div className="grid md:grid-cols-2 gap-12 items-center">
                                                <div>
                                                    <RiskScoreGauge 
                                                        score={selectedContract.riskScore.overall} 
                                                        grade={selectedContract.riskScore.grade}
                                                    />
                                                    <p className="text-center mt-6 text-gray-600">
                                                        {selectedContract.riskScore.overall >= 80 ? "Excellent - This is a fair contract" :
                                                         selectedContract.riskScore.overall >= 70 ? "Good - Minor issues to address" :
                                                         selectedContract.riskScore.overall >= 60 ? "Fair - Some concerning terms" :
                                                         selectedContract.riskScore.overall >= 50 ? "Poor - Multiple red flags" :
                                                         "Critical - Serious issues detected"}
                                                    </p>
                                                </div>

                                                <div className="space-y-4">
                                                    {(Array.isArray(selectedContract.riskScore?.breakdown) ? selectedContract.riskScore.breakdown : []).map((item, i) => (
                                                        <div 
                                                            key={i} 
                                                            className="breakdown-card"
                                                            style={{ animationDelay: `${i * 0.1}s` }}
                                                        >
                                                            <div className="flex justify-between items-center mb-2">
                                                                <div>
                                                                    <span className="font-semibold">{item.category}</span>
                                                                    <span className="ml-3 text-sm text-gray-500">{item.status}</span>
                                                                </div>
                                                                <div className="flex items-center gap-3">
                                                                    <span className="mono font-bold text-lg" style={{
                                                                        color: item.grade.startsWith('A') ? '#00FF88' :
                                                                               item.grade.startsWith('B') ? '#00D9FF' :
                                                                               item.grade.startsWith('C') ? '#FFB800' :
                                                                               item.grade.startsWith('D') ? '#FF8800' : '#FF3366'
                                                                    }}>
                                                                        {item.grade}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div className="category-bar">
                                                                <div 
                                                                    className="category-bar-fill"
                                                                    style={{ 
                                                                        width: `${item.score}%`,
                                                                        background: item.score >= 80 ? '#00FF88' :
                                                                                   item.score >= 70 ? '#00D9FF' :
                                                                                   item.score >= 60 ? '#FFB800' :
                                                                                   item.score >= 50 ? '#FF8800' : '#FF3366'
                                                                    }}
                                                                />
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>

                                        {/* Summary Section */}
                                        <div className="bg-white rounded-2xl p-8 mb-8 border-2 border-gray-200">
                                            <h3 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                                <span className="text-[#00FF88]">âœ“</span>
                                                Standard Terms
                                            </h3>
                                            <div className="space-y-3">
                                                {(Array.isArray(selectedContract.analysis?.summary) ? selectedContract.analysis.summary : []).map((item, i) => (
                                                    <div key={i} className="flex items-start gap-3 fade-in" style={{ animationDelay: `${i * 0.1}s` }}>
                                                        <div className="w-2 h-2 rounded-full bg-[#00FF88] mt-2 flex-shrink-0"></div>
                                                        <p className="text-gray-700">{item}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Quick Stats */}
                                        <div className="grid md:grid-cols-3 gap-6">
                                            <div className="bg-gradient-to-br from-red-50 to-red-100 rounded-2xl p-6 border-2 border-red-200">
                                                <div className="text-3xl mb-2">ðŸ”´</div>
                                                <div className="stat-number text-3xl font-bold text-red-600 mb-1">
                                                    {(selectedContract.analysis?.risks ?? []).filter(r => r.severity === 'high').length}
                                                </div>
                                                <div className="text-sm text-red-700 font-semibold">High Risk Issues</div>
                                            </div>
                                            <div className="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl p-6 border-2 border-yellow-200">
                                                <div className="text-3xl mb-2">ðŸŸ¡</div>
                                                <div className="stat-number text-3xl font-bold text-yellow-600 mb-1">
                                                    {(selectedContract.analysis?.risks ?? []).filter(r => r.severity === 'medium').length}
                                                </div>
                                                <div className="text-sm text-yellow-700 font-semibold">Medium Risk Issues</div>
                                            </div>
                                            <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border-2 border-blue-200">
                                                <div className="text-3xl mb-2">ðŸ’°</div>
                                                <div className="text-xl font-bold text-blue-600 mb-1">
                                                    {selectedContract.analysis.totalSavings}
                                                </div>
                                                <div className="text-sm text-blue-700 font-semibold">Potential Savings</div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* COMPARISON TAB */}
                                {activeTab === 'comparison' && (
                                    <div className="fade-in">
                                        <div className="bg-white rounded-2xl p-8 border-2 border-gray-200">
                                            <div className="mb-8">
                                                <h3 className="text-2xl font-bold mb-2">Market Comparison</h3>
                                                <p className="text-gray-600 mono text-sm">
                                                    Compared to {selectedContract.comparison?.contractsAnalyzed ?? 0} similar contracts in {selectedContract.comparison?.location ?? 'N/A'}
                                                </p>
                                            </div>

                                            {(Array.isArray(selectedContract.comparison?.metrics) && selectedContract.comparison.metrics.length > 0) ? (
                                            <div className="space-y-1">
                                                {/* Header */}
                                                <div className="grid grid-cols-12 gap-4 px-4 py-3 bg-gray-50 rounded-lg font-semibold text-sm text-gray-600 mono">
                                                    <div className="col-span-3">Metric</div>
                                                    <div className="col-span-2 text-right">Your Contract</div>
                                                    <div className="col-span-2 text-right">Market Avg</div>
                                                    <div className="col-span-2 text-center">Difference</div>
                                                    <div className="col-span-3">Suggestion</div>
                                                </div>

                                                {/* Data Rows */}
                                                {selectedContract.comparison.metrics.map((metric, i) => (
                                                    <div 
                                                        key={i}
                                                        className="comparison-row grid grid-cols-12 gap-4 px-4 py-4 rounded-lg border border-gray-100"
                                                        style={{ animationDelay: `${i * 0.05}s` }}
                                                    >
                                                        <div className="col-span-3 font-semibold">{metric.label}</div>
                                                        <div className="col-span-2 text-right mono">{metric.yourValue}</div>
                                                        <div className="col-span-2 text-right mono text-gray-600">{metric.marketAvg}</div>
                                                        <div className="col-span-2 text-center">
                                                            <span className={`status-${metric.status} px-3 py-1 rounded-full text-sm font-semibold mono`}>
                                                                {metric.difference}
                                                            </span>
                                                        </div>
                                                        <div className="col-span-3 text-sm text-gray-600">
                                                            {metric.suggestion || 'â€”'}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            ) : (
                                            <div className="py-12 text-center text-gray-500">
                                                <p className="text-lg mb-2">No market comparison data for this scan.</p>
                                                <p className="text-sm">Re-scan the contract â€” the AI will extract rent, fees, salary, or rates and compare to typical market values.</p>
                                            </div>
                                            )}

                                            {/* Summary Box - only if we have metrics with above/below */}
                                            {(Array.isArray(selectedContract.comparison?.metrics) && selectedContract.comparison.metrics.filter(m => m.status === 'above' || m.status === 'below').length > 0) && (
                                            <div className="mt-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl border-2 border-blue-200">
                                                <h4 className="font-bold text-lg mb-3 flex items-center gap-2">
                                                    <span>ðŸ’¡</span>
                                                    Key Insights
                                                </h4>
                                                <div className="space-y-2 text-sm">
                                                    {selectedContract.comparison.metrics
                                                        .filter(m => m.status === 'above' || m.status === 'below')
                                                        .map((m, i) => (
                                                            <div key={i} className="flex items-start gap-2">
                                                                <span className="text-blue-600">â€¢</span>
                                                                <span>{m.suggestion}</span>
                                                            </div>
                                                        ))
                                                    }
                                                </div>
                                            </div>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {/* RISKS TAB */}
                                {activeTab === 'risks' && (
                                    <div className="fade-in">
                                        {/* Risks Section */}
                                        <div className="mb-8">
                                            <h3 className="text-3xl font-bold mb-2">
                                                Risks Detected ({(selectedContract.analysis?.risks ?? []).length})
                                            </h3>
                                            <p className="text-gray-600 mb-6">Click any risk to see negotiation script</p>
                                            
                                            <div className="space-y-4">
                                                {(Array.isArray(selectedContract.analysis?.risks) ? selectedContract.analysis.risks : []).map((risk, i) => {
                                                    const isExpanded = expandedRisk === i;
                                                    const severityClass = risk.severity === 'high' ? 'risk-high' : risk.severity === 'medium' ? 'risk-medium' : 'risk-low';
                                                    
                                                    return (
                                                        <div
                                                            key={i}
                                                            className="risk-badge bg-white rounded-2xl overflow-hidden border-2 border-gray-200 hover:border-gray-300 transition-all"
                                                            style={{ animationDelay: `${i * 0.15}s` }}
                                                        >
                                                            <div
                                                                className="p-6 cursor-pointer"
                                                                onClick={() => setExpandedRisk(isExpanded ? null : i)}
                                                            >
                                                                <div className="flex items-start gap-4">
                                                                    <div className={`${severityClass} text-white px-4 py-2 rounded-lg font-bold mono text-sm uppercase flex-shrink-0`}>
                                                                        {risk.severity}
                                                                    </div>
                                                                    <div className="flex-1">
                                                                        <h4 className="font-bold text-xl mb-2">{risk.title}</h4>
                                                                        <p className="text-gray-700 mb-3">{risk.description}</p>
                                                                        <div className="flex items-center gap-6 text-sm">
                                                                            <div>
                                                                                <span className="text-gray-500 mono">Standard:</span>
                                                                                <span className="ml-2 text-gray-900">{risk.standard}</span>
                                                                            </div>
                                                                            <div>
                                                                                <span className="text-gray-500 mono">Savings:</span>
                                                                                <span className="ml-2 font-bold text-[#00FF88]">{risk.savings}</span>
                                                                            </div>
                                                                        </div>
                                                                        {risk.legalCode && (
                                                                            <p className="mt-2 text-sm text-gray-500 mono">âš–ï¸ {risk.legalCode}</p>
                                                                        )}
                                                                    </div>
                                                                    <div className="text-2xl text-gray-400">
                                                                        {isExpanded ? 'âˆ’' : '+'}
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            {isExpanded && (
                                                                <div className="border-t border-gray-200 p-6 bg-gray-50 fade-in">
                                                                    <div className="flex items-center justify-between mb-4">
                                                                        <h5 className="font-bold text-lg">ðŸ“§ Negotiation Script</h5>
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                copyToClipboard(risk.script);
                                                                            }}
                                                                            className="mono bg-[#00D9FF] text-white px-6 py-2 rounded-lg font-semibold text-sm hover:shadow-lg"
                                                                        >
                                                                            Copy Email
                                                                        </button>
                                                                    </div>
                                                                    <div className="script-box p-6 rounded-xl">
                                                                        <pre className="whitespace-pre-wrap text-sm leading-relaxed text-gray-800">
{risk.script}
                                                                        </pre>
                                                                    </div>
                                                                    <p className="text-sm text-gray-600 mt-4 italic">
                                                                        ðŸ’¡ Tip: Personalize with landlord/client name and send from your email
                                                                    </p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* CTA */}
                                <div className="bg-gradient-to-r from-[#0A0E27] to-[#1a2847] text-white rounded-2xl p-12 text-center mt-8">
                                    <h3 className="text-3xl font-bold mb-4">Ready to scan another contract?</h3>
                                    <p className="text-xl text-gray-300 mb-8">
                                        Upload any lease, job offer, freelance agreement, or legal document
                                    </p>
                                    <button
                                        onClick={reset}
                                        className="mono bg-gradient-to-r from-[#00D9FF] to-[#00FF88] text-white px-10 py-4 rounded-lg font-bold text-lg hover:shadow-2xl"
                                    >
                                        Scan New Contract
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showCopyFeedback && (
                        <div className="copy-feedback">
                            <div className="flex items-center gap-3">
                                <span className="text-2xl">âœ“</span>
                                <span className="mono font-semibold">Copied to clipboard!</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<ContractScanner />, document.getElementById('root'));
    </script>
</body>
</html>
